var ne=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var J=(i,e,t)=>(ne(i,e,"read from private field"),t?t.call(i):e.get(i)),F=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},B=(i,e,t,s)=>(ne(i,e,"write to private field"),s?s.call(i,t):e.set(i,t),t);import{S as T,i as D,s as O,e as C,E as Y,a as g,b as y,l as Q,n as S,f as x,r as be,F as ie,G as $,g as A,t as H,c as E,d as X,u as V,v as U,w as k,x as I,z as W,C as se,A as oe,H as we,j as Z,X as ee,J as Ce,K as Ne,L as re,q as je,M as ae,N as le,O as ce}from"./vendor.cdcc11b8.js";import{c as z}from"./index.7be84e4f.js";function ye(i){let e,t,s,o;return{c(){var r;e=C("audio"),Y(e.src,t=((r=i[2])==null?void 0:r.source)||void 0)||g(e,"src",t),g(e,"crossorigin","anonymous"),e.controls=!0},m(r,u){y(r,e,u),i[10](e),s||(o=[Q(e,"canplaythrough",i[9]),Q(e,"ended",i[3])],s=!0)},p(r,[u]){var m;u&4&&!Y(e.src,t=((m=r[2])==null?void 0:m.source)||void 0)&&g(e,"src",t)},i:S,o:S,d(r){r&&x(e),i[10](null),s=!1,be(o)}}}function xe(i,e,t){let s,o,r;const u=[];function m(){return Math.floor(o.gain.value*100)}function f(a){o.gain.value=[0,a/100,1].sort()[1]}function l(){const a=new AudioContext,v=a.createMediaElementSource(r);o=a.createGain();const N=a.createMediaStreamDestination();f(z.default.initialVolume),v.connect(o).connect(N),navigator.mediaDevices.getUserMedia=async function(){return await a.resume(),N.stream}}async function d(a){a?t(2,s=a):await r.play()}function w(){return s}function _(a){t(1,r.currentTime+=a,r)}function n(){u.length>0?d(u.shift()):t(2,s=null)}ie(l);const c=()=>d();function h(a){$[a?"unshift":"push"](()=>{r=a,t(1,r)})}return t(2,s=null),[d,r,s,n,u,m,f,w,_,c,h]}class Ae extends T{constructor(e){super();D(this,e,xe,ye,O,{queue:4,getGain:5,setGain:6,play:0,getCurrentTrack:7,forward:8})}get queue(){return this.$$.ctx[4]}get getGain(){return this.$$.ctx[5]}get setGain(){return this.$$.ctx[6]}get play(){return this.$$.ctx[0]}get getCurrentTrack(){return this.$$.ctx[7]}get forward(){return this.$$.ctx[8]}}function ke(i){let e,t,s,o,r=i[0].getDisplayName()+"",u;return{c(){e=C("div"),t=C("div"),t.innerHTML='<svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-6 h-6" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',s=A(),o=C("h2"),u=H(r),g(t,"class","w-8 h-8 mr-3 inline-flex items-center justify-center rounded-full bg-indigo-500 text-white flex-shrink-0"),g(o,"class","text-gray-900 break-words text-lg title-font font-medium"),g(e,"class","flex items-center mb-3")},m(m,f){y(m,e,f),E(e,t),E(e,s),E(e,o),E(o,u)},p(m,[f]){f&1&&r!==(r=m[0].getDisplayName()+"")&&X(u,r)},i:S,o:S,d(m){m&&x(e)}}}function Le(i,e,t){let{participant:s}=e;return i.$$set=o=>{"participant"in o&&t(0,s=o.participant)},[s]}class Me extends T{constructor(e){super();D(this,e,Le,ke,O,{participant:0})}}var G,R,P,K;class Se{constructor(e,t,s,o){F(this,G,void 0);F(this,R,void 0);F(this,P,void 0);F(this,K,void 0);B(this,G,e),B(this,R,t),B(this,K,s),B(this,P,o)}get text(){return J(this,G)}get params(){const[,...e]=J(this,G).split(" ");return e}get participant(){return J(this,R)}respond(e){J(this,K)?J(this,P).call(this,e,J(this,R).getId()):J(this,P).call(this,e)}}G=new WeakMap,R=new WeakMap,P=new WeakMap,K=new WeakMap;class Ie{constructor(e,t){this.audio=e,this.jitsi=t,this.play.bind(this),this.mute.bind(this),this.unmute.bind(this)}async play(){await this.audio.play(),this.unmute()}mute(){}unmute(){}sendMessage(e){this.jitsi.sendMessage(e)}get queue(){return this.audio.queue}get currentTrack(){return this.audio.getCurrentTrack()}set currentTrack(e){this.audio.play(e)}forward(e){this.audio.forward(e)}get volume(){return this.audio.getGain()}set volume(e){this.audio.setGain(e),e&&this.unmute()}}function ue(i,e,t){const s=i.slice();return s[23]=e[t],s}function fe(i){let e,t=i[3]("general.participants")+"",s;return{c(){e=C("h1"),s=H(t),g(e,"class","text-gray-900 text-3xl title-font font-medium mb-4")},m(o,r){y(o,e,r),E(e,s)},p(o,r){r&8&&t!==(t=o[3]("general.participants")+"")&&X(s,t)},d(o){o&&x(e)}}}function de(i){let e,t;return e=new Me({props:{participant:i[23]}}),{c(){V(e.$$.fragment)},m(s,o){U(e,s,o),t=!0},p(s,o){const r={};o&4&&(r.participant=s[23]),e.$set(r)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){I(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Je(i){let e,t,s,o,r,u,m,f,l,d,w={};u=new Ae({props:w}),i[10](u);let _=i[2].length&&fe(i),n=i[2],c=[];for(let a=0;a<n.length;a+=1)c[a]=de(ue(i,n,a));const h=a=>I(c[a],1,1,()=>{c[a]=null});return{c(){e=C("div"),t=A(),s=C("div"),o=C("div"),r=C("div"),V(u.$$.fragment),m=A(),f=C("div"),_&&_.c(),l=A();for(let a=0;a<c.length;a+=1)c[a].c();g(r,"class","w-full sm:w-2/3 md:w-3/4 pt-1 px-2"),g(f,"class","w-full sm:w-1/3 md:w-1/4 px-2"),g(o,"class","flex flex-row flex-wrap py-4"),g(s,"class","container mx-auto")},m(a,v){y(a,e,v),i[9](e),y(a,t,v),y(a,s,v),E(s,o),E(o,r),U(u,r,null),E(o,m),E(o,f),_&&_.m(f,null),E(f,l);for(let N=0;N<c.length;N+=1)c[N].m(f,null);d=!0},p(a,[v]){const N={};if(u.$set(N),a[2].length?_?_.p(a,v):(_=fe(a),_.c(),_.m(f,l)):_&&(_.d(1),_=null),v&4){n=a[2];let b;for(b=0;b<n.length;b+=1){const L=ue(a,n,b);c[b]?(c[b].p(L,v),k(c[b],1)):(c[b]=de(L),c[b].c(),k(c[b],1),c[b].m(f,null))}for(se(),b=n.length;b<c.length;b+=1)h(b);oe()}},i(a){if(!d){k(u.$$.fragment,a);for(let v=0;v<n.length;v+=1)k(c[v]);d=!0}},o(a){I(u.$$.fragment,a),c=c.filter(Boolean);for(let v=0;v<c.length;v+=1)I(c[v]);d=!1},d(a){a&&x(e),i[9](null),a&&x(t),a&&x(s),i[10](null),W(u),_&&_.d(),we(c,a)}}}function me(){alert("Connection failed! Please report this issue"),console.error("Connection Failed!")}function Te(i,e,t){let s,o;Z(i,ee,p=>t(3,o=p));let{isJoined:r=!1}=e,{roomName:u}=e,{jimmiApi:m}=e,f,l,d,w=[];const _=Ce();let n,c;function h(){t(2,s=d.getParticipants())}function a(){for(let p=0;p<w.length;p++)w[p].dispose();d&&d.leave(),l&&l.disconnect()}function v(p){if(p&&(w=p),!!r)for(let j=0;j<w.length;j++)d.addTrack(w[j])}function N(){const p=(j,M,q)=>_("message",new Se(M,d.getParticipantById(j),q,d.sendMessage.bind(d)));d.addEventListener(n.events.conference.PRIVATE_MESSAGE_RECEIVED,(j,M)=>p(j,M,!0)),d.addEventListener(n.events.conference.MESSAGE_RECEIVED,(j,M)=>p(j,M,!1))}async function b(){console.info("Successfully joined conference!"),t(4,r=!0),v();const p=()=>{};d.addEventListener(n.events.conference.MESSAGE_RECEIVED,p),await(M=>new Promise(q=>setTimeout(q,M)))(1e3),d.removeEventListener(n.events.conference.MESSAGE_RECEIVED,p),N()}function L(){console.info("Connection established successfully");const p={startAudioMuted:!1};d=l.initJitsiConference(u.toLowerCase(),p),d.setDisplayName(z.default.jitsiDisplayName),d.on(n.events.conference.CONFERENCE_JOINED,b),d.on(n.events.conference.USER_JOINED,h),d.on(n.events.conference.USER_LEFT,h),d.on(n.events.conference.DISPLAY_NAME_CHANGED,h),d.join("")}function te(){console.info("disconnecting!"),l.removeEventListener(n.events.connection.CONNECTION_ESTABLISHED,L),l.removeEventListener(n.events.connection.CONNECTION_FAILED,me),l.removeEventListener(n.events.connection.CONNECTION_DISCONNECTED,te)}function ge(p){let j=document.createElement("script");j.src=`https://${p.hosts.domain}/libs/lib-jitsi-meet.min.js`,c==null||c.append(j);var M=setInterval(()=>{if(typeof window.JitsiMeetJS!="undefined"){n=window.JitsiMeetJS,n.setLogLevel(n.logLevels.WARN),window.addEventListener("beforeunload",a),window.addEventListener("unload",a);const q={disableAudioLevels:!0,disableThirdPartyRequests:!0,enableAnalyticsLogging:!1};n.init(q),l=new n.JitsiConnection(void 0,null,p),l.addEventListener(n.events.connection.CONNECTION_ESTABLISHED,L),l.addEventListener(n.events.connection.CONNECTION_FAILED,me),l.addEventListener(n.events.connection.CONNECTION_DISCONNECTED,te),l.connect(),n.createLocalTracks({devices:["audio"]}).then(v).catch(Ee=>{throw Ee}),t(5,m=new Ie(f,this)),clearInterval(M)}},10)}function he(p){d.sendMessage(p)}Ne(()=>{a()});function _e(p){$[p?"unshift":"push"](()=>{c=p,t(1,c)})}function ve(p){$[p?"unshift":"push"](()=>{f=p,t(0,f)})}return i.$$set=p=>{"isJoined"in p&&t(4,r=p.isJoined),"roomName"in p&&t(6,u=p.roomName),"jimmiApi"in p&&t(5,m=p.jimmiApi)},t(2,s=[]),[f,c,s,o,r,m,u,ge,he,_e,ve]}class De extends T{constructor(e){super();D(this,e,Te,Je,O,{isJoined:4,roomName:6,jimmiApi:5,joinConference:7,sendMessage:8})}get joinConference(){return this.$$.ctx[7]}get sendMessage(){return this.$$.ctx[8]}}function Oe(i){let e,t,s,o,r,u,m,f,l,d,w,_=i[0]("general.leave")+"",n,c,h,a,v,N;return{c(){e=C("header"),t=C("div"),s=C("a"),o=C("img"),u=A(),m=C("span"),m.textContent="JIMMI",f=A(),l=C("nav"),d=A(),w=C("button"),n=H(_),c=A(),h=re("svg"),a=re("path"),Y(o.src,r=z.logo)||g(o,"src",r),g(o,"alt","Logo"),g(o,"class","w-16 h-16"),g(m,"class","ml-3 text-white text-xl font-mono"),g(s,"href",z.url),g(s,"class","flex title-font font-medium items-center text-gray-900 mb-4 md:mb-0"),g(l,"class","md:ml-auto flex flex-wrap items-center text-base justify-center"),g(a,"d","M5 12h14M12 5l7 7-7 7"),g(h,"fill","none"),g(h,"stroke","currentColor"),g(h,"stroke-linecap","round"),g(h,"stroke-linejoin","round"),g(h,"stroke-width","2"),g(h,"class","w-4 h-4 ml-1"),g(h,"viewBox","0 0 24 24"),g(w,"class","inline-flex items-center bg-gray-100 border-0 py-1 px-3 focus:outline-none hover:bg-gray-200 rounded text-base mt-4 md:mt-0"),g(t,"class","container p-2 mx-auto flex flex-wrap p-1 flex-col md:flex-row items-center"),g(e,"class","bg-indigo-500 text-lightgray-600 body-font")},m(b,L){y(b,e,L),E(e,t),E(t,s),E(s,o),E(s,u),E(s,m),E(t,f),E(t,l),E(t,d),E(t,w),E(w,n),E(w,c),E(w,h),E(h,a),v||(N=Q(w,"click",i[1]),v=!0)},p(b,[L]){L&1&&_!==(_=b[0]("general.leave")+"")&&X(n,_)},i:S,o:S,d(b){b&&x(e),v=!1,N()}}}function $e(i,e,t){let s;Z(i,ee,r=>t(0,s=r));function o(){je("/")}return[s,o]}class Ge extends T{constructor(e){super();D(this,e,$e,Oe,O,{})}}function Re(i){let e;return{c(){e=C("div"),g(e,"class","w-20 h-20 center border-4 border-indigo-600 rounded-full loader svelte-1mrbjhb")},m(t,s){y(t,e,s)},p:S,i:S,o:S,d(t){t&&x(e)}}}class Pe extends T{constructor(e){super();D(this,e,null,Re,O,{})}}function pe(i){let e,t,s,o,r=i[4]("general.connecting")+"",u,m,f;return t=new Pe({}),{c(){e=C("div"),V(t.$$.fragment),s=A(),o=C("p"),u=H(r),m=H("..."),g(o,"class","p-5"),g(e,"class","flex flex-col items-center justify-center h-full")},m(l,d){y(l,e,d),U(t,e,null),E(e,s),E(e,o),E(o,u),E(o,m),f=!0},p(l,d){(!f||d&16)&&r!==(r=l[4]("general.connecting")+"")&&X(u,r)},i(l){f||(k(t.$$.fragment,l),f=!0)},o(l){I(t.$$.fragment,l),f=!1},d(l){l&&x(e),W(t)}}}function qe(i){let e,t,s,o,r,u,m,f;e=new Ge({});let l=!i[2]&&pe(i);function d(n){i[7](n)}function w(n){i[8](n)}let _={roomName:i[0].room};return i[2]!==void 0&&(_.isJoined=i[2]),i[3]!==void 0&&(_.jimmiApi=i[3]),r=new De({props:_}),i[6](r),$.push(()=>ae(r,"isJoined",d)),$.push(()=>ae(r,"jimmiApi",w)),r.$on("message",i[5]),{c(){V(e.$$.fragment),t=A(),l&&l.c(),s=A(),o=C("div"),V(r.$$.fragment),le(o,"hidden",!i[2])},m(n,c){U(e,n,c),y(n,t,c),l&&l.m(n,c),y(n,s,c),y(n,o,c),U(r,o,null),f=!0},p(n,[c]){n[2]?l&&(se(),I(l,1,1,()=>{l=null}),oe()):l?(l.p(n,c),c&4&&k(l,1)):(l=pe(n),l.c(),k(l,1),l.m(s.parentNode,s));const h={};c&1&&(h.roomName=n[0].room),!u&&c&4&&(u=!0,h.isJoined=n[2],ce(()=>u=!1)),!m&&c&8&&(m=!0,h.jimmiApi=n[3],ce(()=>m=!1)),r.$set(h),c&4&&le(o,"hidden",!n[2])},i(n){f||(k(e.$$.fragment,n),k(l),k(r.$$.fragment,n),f=!0)},o(n){I(e.$$.fragment,n),I(l),I(r.$$.fragment,n),f=!1},d(n){W(e,n),n&&x(t),l&&l.d(n),n&&x(s),n&&x(o),i[6](null),W(r)}}}function Fe(i,e,t){let s;Z(i,ee,n=>t(4,s=n));let{params:o}=e,r,u,m;const f={};function l(n){if(n.detail.text.startsWith("!")){const[c]=n.detail.text.split(" ");c in f&&f[c](n.detail)}}ie(()=>{const n={hosts:{domain:o.instance,muc:`conference.${o.instance}`},bosh:`https://${o.instance}/http-bind?room=${o.room}`};r.joinConference(n);const c=new RegExp(/^\w+$/);z.plugins.map(h=>new h(m)).forEach(h=>{Object.keys(h.commands||{}).forEach(a=>{const v=`!${a}`;c.test(a)?v in f?console.warn(`Duplicate command: "${v}" provided by plugin "${h.meta.name}" is already used!`):f[v]=h.commands[a]:console.error(`Invalid command: "${a}" provided by plugin "${h.meta.name}" is not a valid command name!`)})})});function d(n){$[n?"unshift":"push"](()=>{r=n,t(1,r)})}function w(n){u=n,t(2,u)}function _(n){m=n,t(3,m)}return i.$$set=n=>{"params"in n&&t(0,o=n.params)},[o,r,u,m,s,l,d,w,_]}class Ue extends T{constructor(e){super();D(this,e,Fe,qe,O,{params:0})}}export{Ue as default};
