import{D as le,S,i as D,s as J,e as b,a as p,b as N,l as H,n as C,f as x,j as q,E as U,F as P,g as L,t as A,c as h,d as F,q as M,u as $,v as y,w as j,x as O,B as z,z as W,G as ce,X as V,H as ue,J as fe,K as Y,p as de,L as me,M as K,N as pe}from"./vendor.316c308f.js";const T=le([""]);function ge(i){let e,n,s;return{c(){e=b("audio"),p(e,"crossorigin","anonymous"),e.controls=!0},m(o,a){N(o,e,a),i[4](e),n||(s=H(e,"ended",i[1]),n=!0)},p:C,i:C,o:C,d(o){o&&x(e),i[4](null),n=!1,s()}}}function he(i,e,n){let s;q(i,T,t=>n(6,s=t));let{initialVolume:o=20}=e,a,c;function m(t){t=(t/100).toPrecision(3),a.gain.value=[0,t,1].sort()[1]}function r(){const t=new AudioContext,v=t.createMediaElementSource(c);a=t.createGain();const u=t.createMediaStreamDestination();m(o),v.connect(a).connect(u),navigator.mediaDevices.getUserMedia=async function(){return await t.resume(),u.stream}}async function f(t){await c.pause(),c.setAttribute("src",t),await c.play()}function d(){s.length>0&&n(0,c.src=s[0].source,c)}T.subscribe(t=>{c&&(n(0,c.src=t[0].source,c),c.play())}),U(r);function l(t){P[t?"unshift":"push"](()=>{c=t,n(0,c)})}return i.$$set=t=>{"initialVolume"in t&&n(2,o=t.initialVolume)},[c,d,o,f,l]}class _e extends S{constructor(e){super();D(this,e,he,ge,J,{initialVolume:2,playAudio:3})}get playAudio(){return this.$$.ctx[3]}}function ve(i){let e,n,s,o,a=i[0].getDisplayName()+"",c;return{c(){e=b("div"),n=b("div"),n.innerHTML='<svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-6 h-6" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',s=L(),o=b("h2"),c=A(a),p(n,"class","w-8 h-8 mr-3 inline-flex items-center justify-center rounded-full bg-indigo-500 text-white flex-shrink-0"),p(o,"class","text-gray-900 break-words text-lg title-font font-medium"),p(e,"class","flex items-center mb-3")},m(m,r){N(m,e,r),h(e,n),h(e,s),h(e,o),h(o,c)},p(m,[r]){r&1&&a!==(a=m[0].getDisplayName()+"")&&F(c,a)},i:C,o:C,d(m){m&&x(e)}}}function be(i,e,n){let{participant:s}=e;return i.$$set=o=>{"participant"in o&&n(0,s=o.participant)},[s]}class Ee extends S{constructor(e){super();D(this,e,be,ve,J,{participant:0})}}function Q(i,e,n){const s=i.slice();return s[19]=e[n],s}function X(i){let e,n=i[2]("general.participants")+"",s;return{c(){e=b("h1"),s=A(n),p(e,"class","text-gray-900 text-3xl title-font font-medium mb-4")},m(o,a){N(o,e,a),h(e,s)},p(o,a){a&4&&n!==(n=o[2]("general.participants")+"")&&F(s,n)},d(o){o&&x(e)}}}function Z(i){let e,n;return e=new Ee({props:{participant:i[19]}}),{c(){M(e.$$.fragment)},m(s,o){$(e,s,o),n=!0},p(s,o){const a={};o&2&&(a.participant=s[19]),e.$set(a)},i(s){n||(y(e.$$.fragment,s),n=!0)},o(s){j(e.$$.fragment,s),n=!1},d(s){O(e,s)}}}function we(i){let e,n,s,o,a,c,m,r,f={};o=new _e({props:f}),i[6](o);let d=i[1].length&&X(i),l=i[1],t=[];for(let u=0;u<l.length;u+=1)t[u]=Z(Q(i,l,u));const v=u=>j(t[u],1,1,()=>{t[u]=null});return{c(){e=b("div"),n=b("div"),s=b("div"),M(o.$$.fragment),a=L(),c=b("div"),d&&d.c(),m=L();for(let u=0;u<t.length;u+=1)t[u].c();p(s,"class","w-full sm:w-2/3 md:w-3/4 pt-1 px-2"),p(c,"class","w-full sm:w-1/3 md:w-1/4 px-2"),p(n,"class","flex flex-row flex-wrap py-4"),p(e,"class","container mx-auto")},m(u,_){N(u,e,_),h(e,n),h(n,s),$(o,s,null),h(n,a),h(n,c),d&&d.m(c,null),h(c,m);for(let w=0;w<t.length;w+=1)t[w].m(c,null);r=!0},p(u,[_]){const w={};if(o.$set(w),u[1].length?d?d.p(u,_):(d=X(u),d.c(),d.m(c,m)):d&&(d.d(1),d=null),_&2){l=u[1];let E;for(E=0;E<l.length;E+=1){const I=Q(u,l,E);t[E]?(t[E].p(I,_),y(t[E],1)):(t[E]=Z(I),t[E].c(),y(t[E],1),t[E].m(c,null))}for(z(),E=l.length;E<t.length;E+=1)v(E);W()}},i(u){if(!r){y(o.$$.fragment,u);for(let _=0;_<l.length;_+=1)y(t[_]);r=!0}},o(u){j(o.$$.fragment,u),t=t.filter(Boolean);for(let _=0;_<t.length;_+=1)j(t[_]);r=!1},d(u){u&&x(e),i[6](null),O(o),d&&d.d(),ce(t,u)}}}function ee(){alert("Connection failed! Please report this issue"),console.error("Connection Failed!")}function ye(i,e,n){let s,o;q(i,V,g=>n(2,o=g));let{isJoined:a=!1}=e,{roomName:c}=e,m,r,f,d=[];const l=ue(),t=window.JitsiMeetJS;t.setLogLevel(t.logLevels.WARN);function v(){n(1,s=f.getParticipants())}function u(){for(let g=0;g<d.length;g++)d[g].dispose();f&&f.leave(),r&&r.disconnect()}function _(g){if(g&&(d=g),!!a)for(let k=0;k<d.length;k++)f.addTrack(d[k])}function w(){f.addEventListener(t.events.conference.MESSAGE_RECEIVED,(g,k)=>{l("message",{text:k})})}async function E(){console.info("Successfully joined conference!"),n(3,a=!0),_();const g=()=>{};f.addEventListener(t.events.conference.MESSAGE_RECEIVED,g),await(R=>new Promise(ae=>setTimeout(ae,R)))(1e3),f.removeEventListener(t.events.conference.MESSAGE_RECEIVED,g),w()}function I(){console.info("Connection established successfully");const g={startAudioMuted:!1};f=r.initJitsiConference(c.toLowerCase(),g),f.setDisplayName("DJ Jim"),f.on(t.events.conference.CONFERENCE_JOINED,E),f.on(t.events.conference.USER_JOINED,v),f.on(t.events.conference.USER_LEFT,v),f.on(t.events.conference.DISPLAY_NAME_CHANGED,v),f.join("")}function G(){console.info("disconnecting!"),r.removeEventListener(t.events.connection.CONNECTION_ESTABLISHED,I),r.removeEventListener(t.events.connection.CONNECTION_FAILED,ee),r.removeEventListener(t.events.connection.CONNECTION_DISCONNECTED,G)}function oe(g){window.addEventListener("beforeunload",u),window.addEventListener("unload",u);const k={disableAudioLevels:!0,disableThirdPartyRequests:!0,enableAnalyticsLogging:!1};t.init(k),r=new t.JitsiConnection(null,null,g),r.addEventListener(t.events.connection.CONNECTION_ESTABLISHED,I),r.addEventListener(t.events.connection.CONNECTION_FAILED,ee),r.addEventListener(t.events.connection.CONNECTION_DISCONNECTED,G),r.connect(),t.createLocalTracks({devices:["audio"]}).then(_).catch(R=>{throw R})}fe(()=>{u()});function re(g){P[g?"unshift":"push"](()=>{m=g,n(0,m)})}return i.$$set=g=>{"isJoined"in g&&n(3,a=g.isJoined),"roomName"in g&&n(4,c=g.roomName)},n(1,s=[]),[m,s,o,a,c,oe,re]}class Ne extends S{constructor(e){super();D(this,e,ye,we,J,{isJoined:3,roomName:4,joinConference:5})}get joinConference(){return this.$$.ctx[5]}}function Ce(i){let e,n,s,o,a,c,m,r=i[0]("general.leave")+"",f,d,l,t,v,u;return{c(){e=b("header"),n=b("div"),s=b("a"),s.innerHTML=`<img src="/jim.svg" alt="Logo" class="w-16 h-16"/> 
      <span class="ml-3 text-white text-xl font-mono">JIMMI</span>`,o=L(),a=b("nav"),c=L(),m=b("button"),f=A(r),d=L(),l=Y("svg"),t=Y("path"),p(s,"href","https://jimmi.xyz"),p(s,"class","flex title-font font-medium items-center text-gray-900 mb-4 md:mb-0"),p(a,"class","md:ml-auto flex flex-wrap items-center text-base justify-center"),p(t,"d","M5 12h14M12 5l7 7-7 7"),p(l,"fill","none"),p(l,"stroke","currentColor"),p(l,"stroke-linecap","round"),p(l,"stroke-linejoin","round"),p(l,"stroke-width","2"),p(l,"class","w-4 h-4 ml-1"),p(l,"viewBox","0 0 24 24"),p(m,"class","inline-flex items-center bg-gray-100 border-0 py-1 px-3 focus:outline-none hover:bg-gray-200 rounded text-base mt-4 md:mt-0"),p(n,"class","container p-2 mx-auto flex flex-wrap p-1 flex-col md:flex-row items-center"),p(e,"class","bg-indigo-500 text-lightgray-600 body-font")},m(_,w){N(_,e,w),h(e,n),h(n,s),h(n,o),h(n,a),h(n,c),h(n,m),h(m,f),h(m,d),h(m,l),h(l,t),v||(u=H(m,"click",i[1]),v=!0)},p(_,[w]){w&1&&r!==(r=_[0]("general.leave")+"")&&F(f,r)},i:C,o:C,d(_){_&&x(e),v=!1,u()}}}function xe(i,e,n){let s;q(i,V,a=>n(0,s=a));function o(){de("/")}return[s,o]}class Le extends S{constructor(e){super();D(this,e,xe,Ce,J,{})}}function je(i){let e;return{c(){e=b("div"),p(e,"class","w-20 h-20 center border-4 border-indigo-600 rounded-full loader svelte-1mrbjhb")},m(n,s){N(n,e,s)},p:C,i:C,o:C,d(n){n&&x(e)}}}class ke extends S{constructor(e){super();D(this,e,null,je,J,{})}}const Se="https://invidious.snopyta.org";let B=[];T.subscribe(i=>{B=i});async function te(i){return await(await fetch(`${Se}/api/v1/${i}`,{referrerPolicy:"no-referrer"})).json()}async function De(i){const e=await te(`search/?q=${encodeURIComponent(i)}`);return e.length>0?e[0].videoId:null}async function Je(i){const e=await te(`videos/${i}`);if(e.error)return;const n=e.adaptiveFormats.filter(s=>s.encoding==="opus")[0];return{title:e.title,thumbnail:e.videoThumbnails[0].url,source:n.url}}async function ne(i){const e=i.join(" "),n=await De(e);return Je(n)}async function Ie(i){if(i.length!==0){const e=await ne(i);T.set([e])}}async function ie(i){if(i.length!==0){const e=await ne(i);B.length>0?B.push(e):T.set([e])}}const Ae={meta:{name:"Music",description:"A music plugin that allows for playback from youtube",version:"0.1.0"},commands:{play:Ie,queue:ie,cue:ie}};function se(i){let e,n,s,o,a=i[3]("general.connecting")+"",c,m,r;return n=new ke({}),{c(){e=b("div"),M(n.$$.fragment),s=L(),o=b("p"),c=A(a),m=A("..."),p(o,"class","p-5"),p(e,"class","flex flex-col items-center justify-center h-full")},m(f,d){N(f,e,d),$(n,e,null),h(e,s),h(e,o),h(o,c),h(o,m),r=!0},p(f,d){(!r||d&8)&&a!==(a=f[3]("general.connecting")+"")&&F(c,a)},i(f){r||(y(n.$$.fragment,f),r=!0)},o(f){j(n.$$.fragment,f),r=!1},d(f){f&&x(e),O(n)}}}function Me(i){let e,n,s,o,a,c,m;e=new Le({});let r=!i[2]&&se(i);function f(l){i[6](l)}let d={roomName:i[0].room};return i[2]!==void 0&&(d.isJoined=i[2]),a=new Ne({props:d}),i[5](a),P.push(()=>me(a,"isJoined",f)),a.$on("message",i[4]),{c(){M(e.$$.fragment),n=L(),r&&r.c(),s=L(),o=b("div"),M(a.$$.fragment),K(o,"hidden",!i[2])},m(l,t){$(e,l,t),N(l,n,t),r&&r.m(l,t),N(l,s,t),N(l,o,t),$(a,o,null),m=!0},p(l,[t]){l[2]?r&&(z(),j(r,1,1,()=>{r=null}),W()):r?(r.p(l,t),t&4&&y(r,1)):(r=se(l),r.c(),y(r,1),r.m(s.parentNode,s));const v={};t&1&&(v.roomName=l[0].room),!c&&t&4&&(c=!0,v.isJoined=l[2],pe(()=>c=!1)),a.$set(v),t&4&&K(o,"hidden",!l[2])},i(l){m||(y(e.$$.fragment,l),y(r),y(a.$$.fragment,l),m=!0)},o(l){j(e.$$.fragment,l),j(r),j(a.$$.fragment,l),m=!1},d(l){O(e,l),l&&x(n),r&&r.d(l),l&&x(s),l&&x(o),i[5](null),O(a)}}}function $e(i,e,n){let s;q(i,V,t=>n(3,s=t));let{params:o}=e,a,c;const m=[Ae],r={};m.forEach(t=>{Object.keys(t.commands||{}).forEach(v=>{const u=`!${v}`;u in r?console.warn(`Duplicate command: "${u}" provided by plugin "${t.meta.name}" is already used!`):r[u]=t.commands[v]})});function f(t){if(t.detail.text.startsWith("!")){const[v,...u]=t.detail.text.split(" ");v in r&&r[v](u)}}U(()=>{const t={hosts:{domain:o.instance,muc:`conference.${o.instance}`},bosh:`https://${o.instance}/http-bind?room=${o.room}`};a.joinConference(t)});function d(t){P[t?"unshift":"push"](()=>{a=t,n(1,a)})}function l(t){c=t,n(2,c)}return i.$$set=t=>{"params"in t&&n(0,o=t.params)},[o,a,c,s,f,d,l]}class Te extends S{constructor(e){super();D(this,e,$e,Me,J,{params:0})}}export{Te as default};
