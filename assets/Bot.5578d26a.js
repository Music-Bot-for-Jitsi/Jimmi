var le=Object.defineProperty;var ce=(o,e,t)=>e in o?le(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var R=(o,e,t)=>(ce(o,typeof e!="symbol"?e+"":e,t),t);import{S as J,i as k,s as S,e as y,a as h,b as j,l as U,n as C,f as x,D as Y,E as M,g as A,t as q,c as _,d as V,q as O,u as T,v as N,w as L,x as G,B as z,z as W,F as ue,j as B,X as H,G as fe,H as de,J as K,K as me,p as pe,L as X,M as Q,N as Z}from"./vendor.c7285818.js";const P={default:{jitsiDisplayName:"DJ Jim",initialVolume:20},url:"https://jimmi.xyz",logo:"/jim.svg"};function he(o){let e,t,i;return{c(){e=y("audio"),h(e,"crossorigin","anonymous"),e.controls=!0},m(n,l){j(n,e,l),o[6](e),t||(i=U(e,"ended",o[1]),t=!0)},p:C,i:C,o:C,d(n){n&&x(e),o[6](null),t=!1,i()}}}function ge(o,e,t){let i,n;const l=[];function d(){return Math.floor(i.gain.value*100)}function m(c){i.gain.value=[0,c/100,1].sort()[1]}function p(){const c=new AudioContext,r=c.createMediaElementSource(n);i=c.createGain();const s=c.createMediaStreamDestination();m(P.default.initialVolume),r.connect(i).connect(s),navigator.mediaDevices.getUserMedia=async function(){return await c.resume(),s.stream}}async function a(c){c&&t(0,n.src=c.source,n),await n.play()}function u(){l.length>0&&a(l.shift())}Y(p);function g(c){M[c?"unshift":"push"](()=>{n=c,t(0,n)})}return[n,u,l,d,m,a,g]}class _e extends J{constructor(e){super();k(this,e,ge,he,S,{queue:2,getGain:3,setGain:4,play:5})}get queue(){return this.$$.ctx[2]}get getGain(){return this.$$.ctx[3]}get setGain(){return this.$$.ctx[4]}get play(){return this.$$.ctx[5]}}function ve(o){let e,t,i,n,l=o[0].getDisplayName()+"",d;return{c(){e=y("div"),t=y("div"),t.innerHTML='<svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-6 h-6" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',i=A(),n=y("h2"),d=q(l),h(t,"class","w-8 h-8 mr-3 inline-flex items-center justify-center rounded-full bg-indigo-500 text-white flex-shrink-0"),h(n,"class","text-gray-900 break-words text-lg title-font font-medium"),h(e,"class","flex items-center mb-3")},m(m,p){j(m,e,p),_(e,t),_(e,i),_(e,n),_(n,d)},p(m,[p]){p&1&&l!==(l=m[0].getDisplayName()+"")&&V(d,l)},i:C,o:C,d(m){m&&x(e)}}}function be(o,e,t){let{participant:i}=e;return o.$$set=n=>{"participant"in n&&t(0,i=n.participant)},[i]}class Ee extends J{constructor(e){super();k(this,e,be,ve,S,{participant:0})}}class ye{constructor(e,t){this.audio=e,this.jitsi=t,this.play.bind(this),this.mute.bind(this),this.unmute.bind(this)}async play(e){await this.audio.play(e),this.unmute()}mute(){}unmute(){}get queue(){return this.audio.queue}get volume(){return this.audio.getGain()}set volume(e){this.audio.setGain(e),e&&this.unmute()}}function ee(o,e,t){const i=o.slice();return i[20]=e[t],i}function te(o){let e,t=o[2]("general.participants")+"",i;return{c(){e=y("h1"),i=q(t),h(e,"class","text-gray-900 text-3xl title-font font-medium mb-4")},m(n,l){j(n,e,l),_(e,i)},p(n,l){l&4&&t!==(t=n[2]("general.participants")+"")&&V(i,t)},d(n){n&&x(e)}}}function ne(o){let e,t;return e=new Ee({props:{participant:o[20]}}),{c(){O(e.$$.fragment)},m(i,n){T(e,i,n),t=!0},p(i,n){const l={};n&2&&(l.participant=i[20]),e.$set(l)},i(i){t||(N(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){G(e,i)}}}function we(o){let e,t,i,n,l,d,m,p,a={};n=new _e({props:a}),o[7](n);let u=o[1].length&&te(o),g=o[1],c=[];for(let s=0;s<g.length;s+=1)c[s]=ne(ee(o,g,s));const r=s=>L(c[s],1,1,()=>{c[s]=null});return{c(){e=y("div"),t=y("div"),i=y("div"),O(n.$$.fragment),l=A(),d=y("div"),u&&u.c(),m=A();for(let s=0;s<c.length;s+=1)c[s].c();h(i,"class","w-full sm:w-2/3 md:w-3/4 pt-1 px-2"),h(d,"class","w-full sm:w-1/3 md:w-1/4 px-2"),h(t,"class","flex flex-row flex-wrap py-4"),h(e,"class","container mx-auto")},m(s,f){j(s,e,f),_(e,t),_(t,i),T(n,i,null),_(t,l),_(t,d),u&&u.m(d,null),_(d,m);for(let E=0;E<c.length;E+=1)c[E].m(d,null);p=!0},p(s,[f]){const E={};if(n.$set(E),s[1].length?u?u.p(s,f):(u=te(s),u.c(),u.m(d,m)):u&&(u.d(1),u=null),f&2){g=s[1];let v;for(v=0;v<g.length;v+=1){const w=ee(s,g,v);c[v]?(c[v].p(w,f),N(c[v],1)):(c[v]=ne(w),c[v].c(),N(c[v],1),c[v].m(d,null))}for(z(),v=g.length;v<c.length;v+=1)r(v);W()}},i(s){if(!p){N(n.$$.fragment,s);for(let f=0;f<g.length;f+=1)N(c[f]);p=!0}},o(s){L(n.$$.fragment,s),c=c.filter(Boolean);for(let f=0;f<c.length;f+=1)L(c[f]);p=!1},d(s){s&&x(e),o[7](null),G(n),u&&u.d(),ue(c,s)}}}function ie(){alert("Connection failed! Please report this issue"),console.error("Connection Failed!")}function Ne(o,e,t){let i,n;B(o,H,b=>t(2,n=b));let{isJoined:l=!1}=e,{roomName:d}=e,{jimmiApi:m}=e,p,a,u,g=[];const c=fe(),r=window.JitsiMeetJS;r.setLogLevel(r.logLevels.WARN);function s(){t(1,i=u.getParticipants())}function f(){for(let b=0;b<g.length;b++)g[b].dispose();u&&u.leave(),a&&a.disconnect()}function E(b){if(b&&(g=b),!!l)for(let D=0;D<g.length;D++)u.addTrack(g[D])}function v(){u.addEventListener(r.events.conference.MESSAGE_RECEIVED,(b,D)=>{c("message",{text:D})})}async function w(){console.info("Successfully joined conference!"),t(3,l=!0),E();const b=()=>{};u.addEventListener(r.events.conference.MESSAGE_RECEIVED,b),await(F=>new Promise(ae=>setTimeout(ae,F)))(1e3),u.removeEventListener(r.events.conference.MESSAGE_RECEIVED,b),v()}function $(){console.info("Connection established successfully");const b={startAudioMuted:!1};u=a.initJitsiConference(d.toLowerCase(),b),u.setDisplayName(P.default.jitsiDisplayName),u.on(r.events.conference.CONFERENCE_JOINED,w),u.on(r.events.conference.USER_JOINED,s),u.on(r.events.conference.USER_LEFT,s),u.on(r.events.conference.DISPLAY_NAME_CHANGED,s),u.join("")}function I(){console.info("disconnecting!"),a.removeEventListener(r.events.connection.CONNECTION_ESTABLISHED,$),a.removeEventListener(r.events.connection.CONNECTION_FAILED,ie),a.removeEventListener(r.events.connection.CONNECTION_DISCONNECTED,I)}function oe(b){window.addEventListener("beforeunload",f),window.addEventListener("unload",f);const D={disableAudioLevels:!0,disableThirdPartyRequests:!0,enableAnalyticsLogging:!1};r.init(D),a=new r.JitsiConnection(void 0,null,b),a.addEventListener(r.events.connection.CONNECTION_ESTABLISHED,$),a.addEventListener(r.events.connection.CONNECTION_FAILED,ie),a.addEventListener(r.events.connection.CONNECTION_DISCONNECTED,I),a.connect(),r.createLocalTracks({devices:["audio"]}).then(E).catch(F=>{throw F}),t(4,m=new ye(p,this))}de(()=>{f()});function re(b){M[b?"unshift":"push"](()=>{p=b,t(0,p)})}return o.$$set=b=>{"isJoined"in b&&t(3,l=b.isJoined),"roomName"in b&&t(5,d=b.roomName),"jimmiApi"in b&&t(4,m=b.jimmiApi)},t(1,i=[]),[p,i,n,l,m,d,oe,re]}class je extends J{constructor(e){super();k(this,e,Ne,we,S,{isJoined:3,roomName:5,jimmiApi:4,joinConference:6})}get joinConference(){return this.$$.ctx[6]}}function Ce(o){let e,t,i,n,l,d,m,p,a,u,g,c=o[0]("general.leave")+"",r,s,f,E,v,w;return{c(){e=y("header"),t=y("div"),i=y("a"),n=y("img"),d=A(),m=y("span"),m.textContent="JIMMI",p=A(),a=y("nav"),u=A(),g=y("button"),r=q(c),s=A(),f=K("svg"),E=K("path"),me(n.src,l=P.logo)||h(n,"src",l),h(n,"alt","Logo"),h(n,"class","w-16 h-16"),h(m,"class","ml-3 text-white text-xl font-mono"),h(i,"href",P.url),h(i,"class","flex title-font font-medium items-center text-gray-900 mb-4 md:mb-0"),h(a,"class","md:ml-auto flex flex-wrap items-center text-base justify-center"),h(E,"d","M5 12h14M12 5l7 7-7 7"),h(f,"fill","none"),h(f,"stroke","currentColor"),h(f,"stroke-linecap","round"),h(f,"stroke-linejoin","round"),h(f,"stroke-width","2"),h(f,"class","w-4 h-4 ml-1"),h(f,"viewBox","0 0 24 24"),h(g,"class","inline-flex items-center bg-gray-100 border-0 py-1 px-3 focus:outline-none hover:bg-gray-200 rounded text-base mt-4 md:mt-0"),h(t,"class","container p-2 mx-auto flex flex-wrap p-1 flex-col md:flex-row items-center"),h(e,"class","bg-indigo-500 text-lightgray-600 body-font")},m($,I){j($,e,I),_(e,t),_(t,i),_(i,n),_(i,d),_(i,m),_(t,p),_(t,a),_(t,u),_(t,g),_(g,r),_(g,s),_(g,f),_(f,E),v||(w=U(g,"click",o[1]),v=!0)},p($,[I]){I&1&&c!==(c=$[0]("general.leave")+"")&&V(r,c)},i:C,o:C,d($){$&&x(e),v=!1,w()}}}function xe(o,e,t){let i;B(o,H,l=>t(0,i=l));function n(){pe("/")}return[i,n]}class Ae extends J{constructor(e){super();k(this,e,xe,Ce,S,{})}}function Le(o){let e;return{c(){e=y("div"),h(e,"class","w-20 h-20 center border-4 border-indigo-600 rounded-full loader svelte-1mrbjhb")},m(t,i){j(t,e,i)},p:C,i:C,o:C,d(t){t&&x(e)}}}class $e extends J{constructor(e){super();k(this,e,null,Le,S,{})}}class De{constructor(e){this.api=e}}class Ie extends De{constructor(e){super(e);R(this,"meta",{name:"Music",description:"A music plugin that allows for audio playback of youtube videos",version:"0.1.0"});R(this,"commands",{play:this.play.bind(this),queue:this.queue.bind(this),cue:this.queue.bind(this)});R(this,"baseUrl","https://invidious.snopyta.org");this.fetch.bind(this),this.searchYtVideo.bind(this),this.getVideoInfo.bind(this),this.query.bind(this),this.play.bind(this)}async fetch(e){return await(await fetch(`${this.baseUrl}/api/v1/${e}`,{referrerPolicy:"no-referrer"})).json()}async searchYtVideo(e){const t=await this.fetch(`search/?q=${encodeURIComponent(e)}`);return t.length>0?t[0].videoId:null}async getVideoInfo(e){const t=await this.fetch(`videos/${e}`);if(t.error)return null;const i=t.adaptiveFormats.filter(n=>n.encoding==="opus")[0];return{title:t.title,thumbnail:t.videoThumbnails[0].url,source:i.url}}async query(e){const t=e.join(" "),i=await this.searchYtVideo(t);return i?this.getVideoInfo(i):null}async play(e){if(e.length!==0){const t=await this.query(e);if(!t)return;this.api.play(t)}}async queue(e){if(e.length!==0){const t=await this.query(e);if(!t)return;this.api.queue.push(t)}}}function se(o){let e,t,i,n,l=o[4]("general.connecting")+"",d,m,p;return t=new $e({}),{c(){e=y("div"),O(t.$$.fragment),i=A(),n=y("p"),d=q(l),m=q("..."),h(n,"class","p-5"),h(e,"class","flex flex-col items-center justify-center h-full")},m(a,u){j(a,e,u),T(t,e,null),_(e,i),_(e,n),_(n,d),_(n,m),p=!0},p(a,u){(!p||u&16)&&l!==(l=a[4]("general.connecting")+"")&&V(d,l)},i(a){p||(N(t.$$.fragment,a),p=!0)},o(a){L(t.$$.fragment,a),p=!1},d(a){a&&x(e),G(t)}}}function Je(o){let e,t,i,n,l,d,m,p;e=new Ae({});let a=!o[2]&&se(o);function u(r){o[7](r)}function g(r){o[8](r)}let c={roomName:o[0].room};return o[2]!==void 0&&(c.isJoined=o[2]),o[3]!==void 0&&(c.jimmiApi=o[3]),l=new je({props:c}),o[6](l),M.push(()=>X(l,"isJoined",u)),M.push(()=>X(l,"jimmiApi",g)),l.$on("message",o[5]),{c(){O(e.$$.fragment),t=A(),a&&a.c(),i=A(),n=y("div"),O(l.$$.fragment),Q(n,"hidden",!o[2])},m(r,s){T(e,r,s),j(r,t,s),a&&a.m(r,s),j(r,i,s),j(r,n,s),T(l,n,null),p=!0},p(r,[s]){r[2]?a&&(z(),L(a,1,1,()=>{a=null}),W()):a?(a.p(r,s),s&4&&N(a,1)):(a=se(r),a.c(),N(a,1),a.m(i.parentNode,i));const f={};s&1&&(f.roomName=r[0].room),!d&&s&4&&(d=!0,f.isJoined=r[2],Z(()=>d=!1)),!m&&s&8&&(m=!0,f.jimmiApi=r[3],Z(()=>m=!1)),l.$set(f),s&4&&Q(n,"hidden",!r[2])},i(r){p||(N(e.$$.fragment,r),N(a),N(l.$$.fragment,r),p=!0)},o(r){L(e.$$.fragment,r),L(a),L(l.$$.fragment,r),p=!1},d(r){G(e,r),r&&x(t),a&&a.d(r),r&&x(i),r&&x(n),o[6](null),G(l)}}}function ke(o,e,t){let i;B(o,H,s=>t(4,i=s));let{params:n}=e,l,d,m;const p=[Ie],a={};function u(s){if(s.detail.text.startsWith("!")){const[f,...E]=s.detail.text.split(" ");f in a&&a[f](E)}}Y(()=>{const s={hosts:{domain:n.instance,muc:`conference.${n.instance}`},bosh:`https://${n.instance}/http-bind?room=${n.room}`};l.joinConference(s);const f=new RegExp(/^\w+$/);p.map(E=>new E(m)).forEach(E=>{Object.keys(E.commands||{}).forEach(v=>{const w=`!${v}`;f.test(v)?w in a?console.warn(`Duplicate command: "${w}" provided by plugin "${E.meta.name}" is already used!`):a[w]=E.commands[v]:console.error(`Invalid command: "${v}" provided by plugin "${E.meta.name}" is not a valid command name!`)})})});function g(s){M[s?"unshift":"push"](()=>{l=s,t(1,l)})}function c(s){d=s,t(2,d)}function r(s){m=s,t(3,m)}return o.$$set=s=>{"params"in s&&t(0,n=s.params)},[n,l,d,m,i,u,g,c,r]}class qe extends J{constructor(e){super();k(this,e,ke,Je,S,{params:0})}}export{qe as default};
